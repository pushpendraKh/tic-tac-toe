{"ast":null,"code":"import _asyncToGenerator from \"/Users/pushpendra.khandelwal/Desktop/web3_training/tic-tac-toe/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport Web3 from 'web3';\nimport CONSTANTS from '../constant';\nimport { BehaviorSubject } from \"rxjs\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nexport class ContractService {\n  constructor(router) {\n    var _this = this;\n    this.router = router;\n    this.loader$ = new BehaviorSubject(false);\n    this.moveIndex$ = new BehaviorSubject(null);\n    this.getAccounts = /*#__PURE__*/_asyncToGenerator(function* () {\n      try {\n        return yield window.ethereum.request({\n          method: 'eth_accounts'\n        });\n      } catch (e) {\n        return [];\n      }\n    });\n    this.getContract = () => {\n      return new window.web3.eth.Contract(CONSTANTS.abi, CONSTANTS.contractAddress);\n    };\n    // Event can be GameStarted/GameInitiated/GameEnded/PlayerMoved\n    this.parseData = event => {\n      if (!event) return {};\n      let players = event.returnValues?.room?.players;\n      let values = event.returnValues;\n      return {\n        'id': values?.gameId,\n        'name': players[0]?.playerName ?? \"_\" + \"vs\" + players[1]?.playerName ?? \"_\",\n        'currentPlayerIndex': values?.room?.activePlayer,\n        'currentPlayerName': players[values?.room?.activePlayer ?? 0],\n        'winnerName': values?.room?.winnerPlayer?.playerName,\n        'player1': players[0]?.playerName,\n        'player2': players[1]?.playerName,\n        'gameState': this.getState(values?.room?.gameState),\n        'moveIndex': values?.moveIndex,\n        'moveValue': values?.room?.activePlayer == 0 ? \"X\" : \"0\"\n      };\n    };\n    this.getState = state => {\n      switch (state) {\n        case 0:\n          return \"NOT STARTED\";\n        case 1:\n          return \"RUNNING\";\n        case 2:\n          return \"GAME ENDED WITH WINNER\";\n        default:\n          return \"DRAW\";\n      }\n    };\n    this.openMetamask = /*#__PURE__*/_asyncToGenerator(function* () {\n      _this.loader$.next(true);\n      let addresses = yield _this.getAccounts();\n      if (!addresses.length) {\n        try {\n          addresses = yield window.ethereum.enable();\n        } catch (e) {\n          console.log(\"Unable to fetch address\");\n          return false;\n        }\n      }\n      return addresses.length ? addresses[0] : null;\n    });\n    this.joinGame = /*#__PURE__*/function () {\n      var _ref3 = _asyncToGenerator(function* (data) {\n        _this.loader$.next(true);\n        let accaddress = yield _this.getAccounts();\n        try {\n          // TODO: Loading State - true;\n          const response = yield _this.getContract().methods.joinRoom({\n            playerAddress: accaddress[0],\n            playerName: data.name\n          }).send({\n            from: accaddress[0]\n          });\n          // TODO: Loading State - false;\n          _this.gameID = response?.events?.GameStarted?.returnValues?.gameId;\n          // Route to \n          return _this.gameID;\n        } catch (error) {\n          const errorMessage = error;\n        }\n      });\n      return function (_x) {\n        return _ref3.apply(this, arguments);\n      };\n    }();\n    this.move = /*#__PURE__*/function () {\n      var _ref4 = _asyncToGenerator(function* (data) {\n        _this.loader$.next(true);\n        let accaddress = yield _this.getAccounts();\n        try {\n          // TODO: Loading State - true;\n          const response = yield _this.getContract().methods.move(_this.gameID, data).send({\n            from: accaddress[0]\n          });\n          // TODO: Loading State - false;\n          console.log(\"Player moved on \", response?.events?.PlayerMoved?.returnValues?.moveIndex);\n          return response?.events?.PlayerMoved?.returnValues?.moveIndex;\n        } catch (error) {\n          const errorMessage = error;\n        }\n      });\n      return function (_x2) {\n        return _ref4.apply(this, arguments);\n      };\n    }();\n    this.ping = /*#__PURE__*/function () {\n      var _ref5 = _asyncToGenerator(function* (data) {\n        let accaddress = yield _this.getAccounts();\n        try {\n          // TODO: Loading State - true;\n          const response = yield _this.getContract().methods.updateRoomIfExpired(_this.gameID).send({\n            from: accaddress[0]\n          });\n          // TODO: Loading State - false;\n          console.log(\"Game State\", response?.events?.PlayerMoved?.returnValues?.room.state);\n        } catch (error) {\n          const errorMessage = error;\n        }\n      });\n      return function (_x3) {\n        return _ref5.apply(this, arguments);\n      };\n    }();\n    this.isGameRunning = /*#__PURE__*/function () {\n      var _ref6 = _asyncToGenerator(function* (gameId) {\n        try {\n          let accaddress = yield _this.getAccounts();\n          if (!!accaddress) return false;\n          const response = yield _this.getContract().methods.isGameRunning(_this.gameID).call({\n            from: accaddress[0]\n          });\n          console.log(\"res\", response);\n          return response;\n        } catch (error) {\n          console.log(error);\n          return false;\n        }\n      });\n      return function (_x4) {\n        return _ref6.apply(this, arguments);\n      };\n    }();\n    this.isGameValid = /*#__PURE__*/function () {\n      var _ref7 = _asyncToGenerator(function* (gameId) {\n        try {\n          let accaddress = yield _this.getAccounts();\n          if (!!accaddress) return false;\n          const response = yield _this.getContract().methods.totalGames(_this.gameID).call({\n            from: accaddress[0]\n          });\n          return gameId <= response;\n        } catch (error) {\n          console.log(error);\n          return false;\n        }\n      });\n      return function (_x5) {\n        return _ref7.apply(this, arguments);\n      };\n    }();\n    window.web3 = new Web3(Web3.givenProvider || 'http://localhost:7545');\n    let options = {\n      filter: {\n        value: []\n      }\n    };\n    let contract = this.getContract();\n    contract.events.GameEnded(options).on('data', response => {\n      console.log(response?.events, \"Ended\");\n      let gameState = this.parseData(response.events).gameState;\n      alert(`Game State: ${gameState}`);\n      this.router.navigateByUrl(`/home`);\n    });\n    contract.events.GameStarted(options).on('data', response => {\n      console.log(response?.events, \"GameStarted\");\n      this.router.navigateByUrl(`/game/${this.parseData(response?.events?.GameStarted)}`);\n    });\n    contract.events.GameInitiated(options).on('data', response => {\n      console.log(response, \"GameInitiated\");\n      this.router.navigateByUrl(`/game/${this.parseData(response?.events?.GameInitiated)}`);\n    });\n    contract.events.PlayerMoved(options).on('data', response => this.moveIndex$.next(this.parseData(response.events.PlayerMoved)));\n  }\n}\nContractService.ɵfac = function ContractService_Factory(t) {\n  return new (t || ContractService)(i0.ɵɵinject(i1.Router));\n};\nContractService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: ContractService,\n  factory: ContractService.ɵfac,\n  providedIn: 'root'\n});","map":{"version":3,"mappings":"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","names":["Web3","CONSTANTS","BehaviorSubject","ContractService","constructor","router","window","ethereum","request","method","e","web3","eth","Contract","abi","contractAddress","event","players","returnValues","room","values","gameId","playerName","activePlayer","winnerPlayer","getState","gameState","moveIndex","state","loader$","next","addresses","getAccounts","length","enable","console","log","data","accaddress","response","getContract","methods","joinRoom","playerAddress","name","send","from","gameID","events","GameStarted","error","errorMessage","move","PlayerMoved","updateRoomIfExpired","isGameRunning","call","totalGames","givenProvider","options","filter","value","contract","GameEnded","on","parseData","alert","navigateByUrl","GameInitiated","moveIndex$","factory","providedIn"],"sourceRoot":"","sources":["/Users/pushpendra.khandelwal/Desktop/web3_training/tic-tac-toe/ui/src/app/services/contract.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport Web3 from 'web3';\nimport CONSTANTS from '../constant';\nimport { BehaviorSubject } from \"rxjs\";\nimport { Router } from \"@angular/router\";\n\ndeclare const window: any;\n@Injectable({\n  providedIn: 'root',\n})\nexport class ContractService {\n  public loader$ = new BehaviorSubject<boolean>(false);\n\n  public moveIndex$ = new BehaviorSubject<any>(null);\n\n  window: any;\n  gameID: any;\n\n  constructor(private router: Router) {\n    window.web3 = new Web3(Web3.givenProvider || 'http://localhost:7545');\n\n    let options = {\n      filter: {\n          value: [],\n      },\n    }\n    \n    let contract = this.getContract();\n\n    contract.events.GameEnded(options)\n    .on('data', (response: any) => {\n      console.log(response?.events, \"Ended\");\n      let gameState = this.parseData(response.events).gameState\n      alert(`Game State: ${gameState}`)\n      this.router.navigateByUrl(`/home`);\n    });\n\n    contract.events.GameStarted(options)\n    .on('data', (response: any) => {\n      console.log(response?.events, \"GameStarted\");\n      this.router.navigateByUrl(`/game/${this.parseData(response?.events?.GameStarted)}`);\n    });\n\n    contract.events.GameInitiated(options)\n    .on('data', (response: any) => {\n      console.log(response, \"GameInitiated\");\n      this.router.navigateByUrl(`/game/${this.parseData(response?.events?.GameInitiated)}`);\n    });\n\n    contract.events.PlayerMoved(options)\n    .on('data', (response: any) => this.moveIndex$.next(this.parseData(response.events.PlayerMoved)));\n  };\n\n\n  private getAccounts = async () => {\n    try {\n      return await window.ethereum.request({ method: 'eth_accounts' });\n    } catch (e) {\n      return [];\n    }\n  };\n\n  private getContract = () => {\n    return new window.web3.eth.Contract(\n      CONSTANTS.abi,\n      CONSTANTS.contractAddress\n    );\n  };\n\n\n  // Event can be GameStarted/GameInitiated/GameEnded/PlayerMoved\n  public parseData = (event: any) => {\n    if(!event) return {};\n\n    let players = event.returnValues?.room?.players;\n    let values = event.returnValues;\n    return {\n      'id': values?.gameId,\n      'name': players[0]?.playerName ?? \"_\" + \"vs\" + players[1]?.playerName ?? \"_\",\n      'currentPlayerIndex': values?.room?.activePlayer,\n      'currentPlayerName': players[values?.room?.activePlayer ?? 0],\n      'winnerName': values?.room?.winnerPlayer?.playerName,\n      'player1': players[0]?.playerName,\n      'player2': players[1]?.playerName,\n      'gameState': this.getState(values?.room?.gameState),\n      'moveIndex': values?.moveIndex,\n      'moveValue': values?.room?.activePlayer == 0 ? \"X\" : \"0\",\n    };\n  }\n\n  private getState = (state: number) => {\n    switch (state) {\n      case 0:\n        return \"NOT STARTED\";\n      case 1:\n        return \"RUNNING\";\n      case 2: \n        return \"GAME ENDED WITH WINNER\";\n      default:\n        return \"DRAW\";      \n    }\n  }\n\n  public openMetamask = async () => {\n    this.loader$.next(true);\n    let addresses = await this.getAccounts();\n    if (!addresses.length) {\n      try {\n        addresses = await window.ethereum.enable();\n      } catch (e) {\n        console.log(\"Unable to fetch address\");\n        return false;\n      }\n    }\n    return addresses.length ? addresses[0] : null;\n  };\n\n  public joinGame = async (data: any) => {\n    this.loader$.next(true);\n    let accaddress = await this.getAccounts();\n    try {\n      // TODO: Loading State - true;\n      const response = await this.getContract().methods\n        .joinRoom({ playerAddress: accaddress[0], playerName: data.name })\n        .send({ from: accaddress[0] });\n\n      // TODO: Loading State - false;\n\n      this.gameID = response?.events?.GameStarted?.returnValues?.gameId;\n\n      // Route to \n      return this.gameID;\n    } catch (error) {\n      const errorMessage = error;\n    }\n  };\n\n  public move = async (data: any) => {\n    this.loader$.next(true);\n    let accaddress = await this.getAccounts();\n    try {\n      // TODO: Loading State - true;\n      const response = await this.getContract().methods\n        .move(this.gameID, data)\n        .send({ from: accaddress[0] });\n      // TODO: Loading State - false;\n      console.log(\"Player moved on \", response?.events?.PlayerMoved?.returnValues?.moveIndex);\n\n      return response?.events?.PlayerMoved?.returnValues?.moveIndex;\n    } catch (error) {\n      const errorMessage = error;\n    }\n  };\n\n  public ping = async (data: any) => {\n    let accaddress = await this.getAccounts();\n    try {\n      // TODO: Loading State - true;\n      const response = await this.getContract().methods\n        .updateRoomIfExpired(this.gameID)\n        .send({ from: accaddress[0] });\n      // TODO: Loading State - false;\n      console.log(\"Game State\", response?.events?.PlayerMoved?.returnValues?.room.state);\n    } catch (error) {\n      const errorMessage = error;\n    }\n  };\n\n  public isGameRunning = async (gameId: number) => {\n    try {\n      let accaddress = await this.getAccounts();\n      if(!!accaddress) return false;  \n      \n      const response = await this.getContract().methods\n        .isGameRunning(this.gameID)\n        .call({ from: accaddress[0] });\n      console.log(\"res\", response);\n      return response;\n    } catch (error) {\n      console.log(error);\n      return false;\n    }\n  };\n\n  public isGameValid = async (gameId: number) => {\n    try {\n      let accaddress = await this.getAccounts();\n      if(!!accaddress) return false;  \n      \n      const response = await this.getContract().methods\n        .totalGames(this.gameID)\n        .call({ from: accaddress[0] });\n      return gameId <= response;\n    } catch (error) {\n      console.log(error);\n      return false;\n    }\n  };\n}\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}